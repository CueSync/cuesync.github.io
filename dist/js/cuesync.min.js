/*!
  * CueSync v1.0.0-alpha1 (https://cuesync.github.io/)
  * Copyright 2024 Neeraj Kumar Das (https://github.com/nkdas91)
  * Licensed under MIT (https://github.com/cuesync/cuesync/blob/master/LICENSE)  
  */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t="undefined"!=typeof globalThis?globalThis:t||self).cuesync=e()}(this,(function(){"use strict";const t=new Map,e={set(e,s,i){t.has(e)||t.set(e,new Map);const r=t.get(e);r.has(s)||0===r.size?r.set(s,i):console.error(`CueSync doesn't allow more than one instance per element. Bound instance: ${Array.from(r.keys())[0]}.`)},get:(e,s)=>t.has(e)&&t.get(e).get(s)||null,remove(e,s){if(!t.has(e))return;const i=t.get(e);i.delete(s),0===i.size&&t.delete(e)}},s=t=>!(!t||"object"!=typeof t)&&void 0!==t.nodeType,i=t=>s(t)?t:"string"==typeof t&&t.length>0?document.querySelector(t):null;function r(t){if("true"===t)return!0;if("false"===t)return!1;if(t===Number(t).toString())return Number(t);if(""===t||"null"===t)return null;if("string"!=typeof t)return t;try{return JSON.parse(decodeURIComponent(t))}catch(e){return t}}function n(t){return t.replace(/[A-Z]/g,(t=>`-${t.toLowerCase()}`))}const o={setDataAttribute(t,e,s){t.setAttribute(`data-cs-${n(e)}`,s)},removeDataAttribute(t,e){t.removeAttribute(`data-cs-${n(e)}`)},getDataAttributes(t){if(!t)return{};const e={},s=Object.keys(t.dataset).filter((t=>t.startsWith("cs")&&!t.startsWith("csConfig")));for(const i of s){let s=i.replace(/^cs/,"");s=s.charAt(0).toLowerCase()+s.slice(1,s.length),e[s]=r(t.dataset[i])}return e},getDataAttribute:(t,e)=>r(t.getAttribute(`data-cs-${n(e)}`))};class c{static get Default(){return{}}static get DefaultType(){return{}}static get NAME(){throw new Error('You have to implement the static method "NAME", for each component!')}_getConfig(t){return t=this._mergeConfigObj(t),t=this._configAfterMerge(t),this._typeCheckConfig(t),t}_configAfterMerge(t){return t}_mergeConfigObj(t,e){const i=s(e)?o.getDataAttribute(e,"config"):{};return{...this.constructor.Default,..."object"==typeof i?i:{},...s(e)?o.getDataAttributes(e):{},..."object"==typeof t?t:{}}}_typeCheckConfig(t,e=this.constructor.DefaultType){for(const r of Object.keys(e)){const n=e[r],o=t[r],c=s(o)?"element":null==(i=o)?`${i}`:Object.prototype.toString.call(i).match(/\s([a-z]+)/i)[1].toLowerCase();if(!new RegExp(n).test(c))throw new TypeError(`${this.constructor.NAME.toUpperCase()}: Option "${r}" provided type "${c}" but expected type "${n}".`)}var i}}class a extends c{constructor(t,s){super(),(t=i(t))&&(this._element=t,this._config=this._getConfig(s),e.set(this._element,this.constructor.DATA_KEY,this))}dispose(){e.remove(this._element,this.constructor.DATA_KEY);for(const t of Object.getOwnPropertyNames(this))this[t]=null}_getConfig(t){return t=this._mergeConfigObj(t,this._element),t=this._configAfterMerge(t),this._typeCheckConfig(t),t}static getInstance(t){return e.get(i(t),this.DATA_KEY)}static getOrCreateInstance(t,e={}){return this.getInstance(t)||new this(t,"object"==typeof e?e:null)}static get VERSION(){return"1.0.0-alpha1"}static get DATA_KEY(){return`cs.${this.NAME}`}}return{CueSync:class extends a{constructor(t,e){super(t),this._element=t,this._config=this._getConfig(e),this._autoScroll=!0,this._timeMaxWidth=0,this.refresh()}static get NAME(){return"cuesync"}refresh(){const{transcriptPath:t}=this._config,{media:e}=this._config,{displayTime:s}=this._config;fetch(t).then((t=>t.text())).then((t=>{const i=this.parseTranscript(t);for(const[t,r]of i.entries()){const n=document.createElement("div");if(n.className="transcript-line",n.textContent=r.text.trim(),s){const t=document.createElement("div");t.className="transcript-line-container",t.setAttribute("aria-label",r.text.trim()),t.setAttribute("role","button");const s=document.createElement("span");s.className="time",s.textContent=`${r.startTimeRaw}`,t.append(s),t.append(n),this._element.append(t),t.addEventListener("click",(()=>{e.currentTime=r.startTime})),t.addEventListener("keypress",(t=>{"Enter"===t.key&&(e.currentTime=r.startTime)})),t.tabIndex=0,s.getBoundingClientRect().width>this._timeMaxWidth&&(this._timeMaxWidth=s.getBoundingClientRect().width)}else this._element.append(n),n.setAttribute("aria-label",r.text.trim()),n.setAttribute("role","button"),n.addEventListener("click",(()=>{e.currentTime=r.startTime})),n.addEventListener("keypress",(t=>{"Enter"===t.key&&(e.currentTime=r.startTime)})),n.tabIndex=0;this._element.addEventListener("scroll",(()=>{this._autoScroll&&(this._autoScroll=!1)})),this.addMediaEventListener(n,i,r,t)}this._timeMaxWidth&&this._element.style.setProperty("--cs-time-width",`${this._timeMaxWidth}px`)})).catch((t=>console.error("Error loading transcript file:",t)))}parseTranscript(t){const e=[],s=t.split("\n");let i=null;for(let t of s)if(t=t.trim(),t||(i&&e.push(i),i=null),i||!/^\d+$/.test(t))if(t.includes("--\x3e")){const[e,s]=t.split(/ --> /);i=new VTTCue(this.convertToSeconds(e),this.convertToSeconds(s),""),i.startTimeRaw=this.minimalTime(e)}else i&&(i.text+=`${t} `);return i&&e.push(i),e}convertToSeconds(t){const[e,s,i]=t.split(/:|,/).map(Number.parseFloat);return(3600*e+60*s+i).toFixed(2)}minimalTime(t){const[e,s,i]=t.split(/:|,/).map(Number.parseFloat);return`${0===e?"":`${e} : `} ${s} : ${Math.trunc(i)}`}autoScroll(t){if(this._autoScroll)this.scrollToView(t);else{const e=this._element.getBoundingClientRect(),s=t.getBoundingClientRect();s.top>=e.top&&s.bottom<=e.bottom&&(this._autoScroll=!0)}}scrollToView(t){const e=t.closest(".transcript-container"),s=t.offsetTop-e.offsetTop,i=t.offsetHeight,r=e.clientHeight,n=e.scrollTop;s<n?e.scrollTo({top:s,left:0,behavior:"smooth"}):s+i>n+r&&e.scrollTo({top:s+i-r,left:0,behavior:"smooth"})}addMediaEventListener(t,e,s,i){const{media:r}=this._config,{displayTime:n}=this._config;r.addEventListener("timeupdate",(()=>{i===e.length-1&&r.currentTime>=s.startTime||r.currentTime>=s.startTime&&r.currentTime<s.endTime?(n?t.closest(".transcript-line-container").classList.add("active"):t.classList.add("active"),this.autoScroll(t)):(n?t.closest(".transcript-line-container").classList.remove("active"):t.classList.remove("active"),r.currentTime>=s.startTime?n?t.closest(".transcript-line-container").classList.add("played"):t.classList.add("played"):n?t.closest(".transcript-line-container").classList.remove("played"):t.classList.remove("played"))}))}redrawTime(){const t=Array.prototype.slice.call(this._element.querySelectorAll(".time"));if(t){let e=0;for(const s of t)s.getBoundingClientRect().width>e&&(e=s.getBoundingClientRect().width);e&&this._element.style.setProperty("--cs-time-width",`${e}px`)}}}}}));
//# sourceMappingURL=cuesync.min.js.map